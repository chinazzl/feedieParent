# feedieParent
1. 对于商品金钱展示，在后台进行定义VO类的时候，金钱使用int类型，数据库存储到以分为单位

2. mybatis 使用`<if>`标签，里面进行字符校验需要在单引号替换为`&quot;`,因为如果不这样设置，mybatis将使用`==`的变量转换为number类型

   ```xml
   <!-- c: 商品销量优先 降序
             p: 价格优先 降序
             k: 默认排序-->
   <choose>
       <when test="paramsMap.sort == &quot;c&quot;">
           ORDER BY  item.sell_counts desc
       </when>
       <when test="'p'.equals(paramsMap.sort)">
           ORDER BY temp.discount desc
       </when>
       <otherwise>
           ORDER BY item.item_name asc
       </otherwise>
   </choose>
   ```

3. 购物车存储：

   1. Cookie：
      - 无需登录、无需查库、保存在浏览器端
      - 性能好、访问快、没有和数据库交互
      - 缺点： 1. 换电脑购物车数据会丢失。2.  电脑被其他人登录，隐私安全
      
      将购物车信息存入到cookie中的时候只是一个临时存储，如果用户长时间没有支付，再从cookie中取出数据，价格还是原来的价格，就会出现问题
   2. Session：
      - 用户登录后，购物车数据放入用户会话
      - 优点：初期性能较好，访问快
      - 缺点1：session基于内存，用户量庞大影响服务器性能。2. 只能存在与当前会话，不适用集群与分布式系统。
   3. 数据库：
      - 用户登录后，购物车数据存入数据库
      - 有点：数据持久化，可在任何地点任何时间访问
      - 缺点：频繁读写数据库，造成数据库压力
   4. Redis：
      - 用户登陆后，购物车数据存入redis缓存
      - 优点：1. 数据持久化，可在任何地点任何时间访问。2. 频繁读写只基于缓存，不会造成数据库压力。3. 适用于集群与分布式系统，可扩展性强。
   
4. 购物车细节：大部分操作都是在前台进行操作的

   1. 购物车计算逻辑：
      - 前端先从cookie中拿出购物车的商品信息
      - 前端获取选中的商品规格id
      - 将从cookie中拿出的商品信息的规格id和选中的商品规格Id进行比对校验，如果相同则从cookie获取的购物车Array中删除从指定index的1个元素
   2. 购物车商品删除：
      - 前端先从cookie中拿出购物车的商品信息
      - 前端获取选中的商品规格id
      - 将从cookie中拿出的商品信息的规格id和选中的商品规格Id进行比对校验，如果相同则从cookie获取的购物车Array中获得的priceDiscount * buyCoutnt进行累计相加即为总价格数，并赋值到前台。
      - 重新在前台存入cookie，清除选中向
      - 如果用户已经登陆，则把redis中的购物车进行删除
   
5. 订单 业务流程

   1. 创建订单
      - 新订单数据保存
      - 根据商品规格Id，保存订单商品信息
      - 保存订单状态 
   2. 创建订单后，移除购物车中已经结算的商品
      - 整合redis后，完善购物车的已结算商品清除，并且同步到前端cookie中
   3. 向支付中心发送当前订单，用于保存支付中心的订单数据
   
6. 使用定时任务关闭超期未支付订单的弊端以及优化

   1. 弊端：
      - 会有时间差，程序不严谨：例如电商使用定时任务关闭超期未支付的订单，10：39下单，11:00进行检查不足一个小时，则12:00进行检查，超过一个小时三十九分钟
      - 不支持集群
      - 会对数据库进行全表搜索，影响数据库的使用，例如 使用tk.mybatis 的 select方法会生成select * from table的语句
   2. 优化：
      - 不支持集群可以只是用一台服务器节点单独运行所有的定时任务
      - 使用消息队列：RabiitMq、Kafka、RocketMq
      - 使用延时任务（队列）

